services:
  # WhatsApp Web.js Gateway - Personal WhatsApp API
  # QR code will be shown in container logs: docker-compose logs -f wpp-gateway
  wpp-gateway:
    build: ./wpp-gateway
    container_name: wpp_gateway
    restart: always
    ports:
      - "3000:3000"
    environment:
      - WEBHOOK_URL=http://whatsapp_agent:8082/webhook/wpp
      - PORT=3000
      - SESSION_NAME=${WPP_SESSION:-default}
    volumes:
      - wpp_session:/app/session
    networks:
      - whatsapp_network

  # Python B2B Operations Manager Agent
  whatsapp_agent:
    build: .
    container_name: whatsapp_agent
    restart: always
    ports:
      - "8082:8082"
    environment:
      # Meta WhatsApp API (get from developers.facebook.com)
      - META_API_TOKEN=${META_API_TOKEN}
      - META_PHONE_NUMBER_ID=${META_PHONE_NUMBER_ID}
      # Google Cloud / Vertex AI
      - GOOGLE_PROJECT_ID=${GOOGLE_PROJECT_ID}
      - GOOGLE_LOCATION=${GOOGLE_LOCATION:-us-central1}
      - GEMINI_MODEL=${GEMINI_MODEL:-gemini-2.0-flash-001}
      # Google Sheets
      - SPREADSHEET_ID=${SPREADSHEET_ID}
      - DRIVE_ROOT_FOLDER_ID=${DRIVE_ROOT_FOLDER_ID}
      # Clients file for name lookup
      - CLIENTS_FILE=/app/clients.json
      # B2B Operations Manager
      - WHITELIST_NUMBERS=${WHITELIST_NUMBERS:-}
      # WPP Gateway Configuration (new whatsapp-web.js based)
      - WPP_BASE_URL=http://wpp_gateway:3000
      - WPP_SESSION=${WPP_SESSION:-default}
    volumes:
      - ./service-account.json:/app/service-account.json:ro
      - ./clients.json:/app/clients.json
    networks:
      - whatsapp_network
    depends_on:
      - wpp-gateway

networks:
  whatsapp_network:
    driver: bridge

volumes:
  wpp_session:
